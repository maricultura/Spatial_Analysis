---
title: "Growth Model"
author: "Anna Calle"
date: "1/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

three inputs for species:

- salmon
- gilthead
- cobia


Step 1. Defining values for coefficients/variables based on inputs

a1 = if (input$species = salmon){
coeff for salmon
}
else if (input$species = gilthead){
coeff for gilthead
}
else (input$species = cobia){
coeff for cobia
}

a2 = if (input$species = salmon){
coeff for salmon
}
else if (input$species = gilthead){
coeff for gilthead
}
else (input$species = cobia){
coeff for cobia
}

b1 = if (input$species = salmon){
coeff for salmon
}
else if (input$species = gilthead){
coeff for gilthead
}
else (input$species = cobia){
coeff for cobia
}

b2 = if (input$species = salmon){
coeff for salmon
}
else if (input$species = gilthead){
coeff for gilthead
}
else (input$species = cobia){
coeff for cobia
}

T0 =
if (input$species = salmon){
coeff for salmon
}
else if (input$species = gilthead){
coeff for gilthead
}
else (input$species = cobia){
coeff for cobia
}


Mean Sea-Surface Temperatures (SST), bio-oracle.org
```{r}
# Download Files
# mean_sst <- load_layers("BO2_tempmean_ss")

# Reproject to 5880 (Brazil's CRS)
# mean_sst_proj <-  projectRaster(mean_sst, crs = crs_BRA)

# View CRS
# st_crs(mean_sst_proj)

# Crop to Brazil EEZ
# mean_sst_crop <- crop(mean_sst_proj, eez_BRA)

# Mask to Brazil EEZ
# mean_sst_mask <- mask(mean_sst_crop, eez_BRA)

# Save raster
# writeRaster(mean_sst_mask, paste0(path, "/mean_sst_mask.tif"), overwrite = T)


# Read saved raster
mean_sst_mask <- raster(paste0(path,"/mean_sst_mask.tif"))
```



```{r}
# Overlay suitable raster and mean SST
suitable_sst <- overlay(mean_sst_mask, suitable, fun = function(x, y) {x * y})
plot(suitable_sst)
```






```{r}


a1 = 0.0714
a2 = -0.1667
b1 = -1.5714
b2 = 5.3333
T0 = 29

growth_function = function (a1, a2, b1, b2, T0, temp_suitable_raster) {
if (temp_suitable_raster < T0) {
lower_growth_eq <- a1*temp_suitable_raster - b1

plot(lower_growth_eq)
}

else {
upper_growth_eq <- a2*temp_suitable_raster + b2

plot(upper_growth_eq)
}
}


growth_eq <- ifelse(temp_suitable_raster < T0 , a1*temp_suitable_raster - b1 , a2*temp_suitable_raster + b2)

# Apply function

growth_function(a1, a2, b1, b2, T0, temp_suitable_raster = mean_sst)
```



```{r}

# Convert zeros into NAs, otherwise all background would be less than T0
suitable_sst[suitable_sst == 0] <- NA 

# Separete cells into cells above and below optimal SST
cells_below_optimal <- suitable_sst < T0
plot(cells_below_optimal)

cells_above_optimal <-  suitable_sst > T0
plot(cells_above_optimal)

# Apply growth equations
growth_below_optimal <- a1*cells_below_optimal*suitable_sst - b1*cells_below_optimal
growth_above_optimal <- a2*cells_above_optimal*suitable_sst + b2*cells_above_optimal

# Plot results of growth equations
plot(growth_below_optimal)
plot(growth_above_optimal)

# Add both rasters
growth_added <- growth_above_optimal + growth_below_optimal

# Plot final raster
plot(growth_added)

```


```{r}

growth_function = function (a1, a2, b1, b2, T0, temp_suitable_raster) {
# Convert zeros into NAs, otherwise all background would be less than T0
suitable_sst[suitable_sst == 0] <- NA

# Separete cells into cells above and below optimal SST
cells_below_optimal <- suitable_sst < T0
plot(cells_below_optimal)

cells_above_optimal <-  suitable_sst > T0
plot(cells_above_optimal)

# Apply growth equations
growth_below_optimal <- a1*cells_below_optimal*suitable_sst - b1*cells_below_optimal
growth_above_optimal <- a2*cells_above_optimal*suitable_sst + b2*cells_above_optimal

# Plot results of growth equations
plot(growth_below_optimal)
plot(growth_above_optimal)

# Add both rasters
growth_added <- growth_above_optimal + growth_below_optimal

# Plot final raster
plot(growth_added)

}

```


